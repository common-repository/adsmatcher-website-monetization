<?php
namespace Adsmatcher\WebsiteMonetization;

class AdsMatcherMonetizationPlugin
{
	const ADSMATCHER_MONETIZATION_ACTIVATED = 'adsmatcher_activated';
	
	public function __construct(string $file)
	{
		register_activation_hook($file, [$this, 'plugin_activation']);
		add_action('admin_notices', [$this, 'notice_activation']);
		add_action('admin_menu', [$this, 'adsmatchermonetization_menu_page']);
	}
	
	public function plugin_activation(): void
	{
		set_transient(self::ADSMATCHER_MONETIZATION_ACTIVATED, true);
	}
	
	public function notice_activation(): void
	{
		if(get_transient(self::ADSMATCHER_MONETIZATION_ACTIVATED)){
			self::render('notices', ['message' => "<h3 style='padding:2px;font-weight:normal;margin:.5em 0 0;'>Thank you for using <strong>AdsMatcher Website Monetization</strong> !</h3> <p>AdsMatcher Website Monetizing Plugin is installed successfully! Create a Free <a target='_blank' href='https://www.adsmatcher.com/signup/'>AdsMatcher Publisher Account</a> to Get Started.</p>"]);
			delete_transient(self::ADSMATCHER_MONETIZATION_ACTIVATED);
			update_option('adsmatcher_website_publicid', '');
			update_option('adsmatcher_wordpress_key', '');
		}
	}

	public static function render(string $name, array $args = []): void
	{
		extract($args);
		$file = ADSMATCHERMONETIZATIONPLUGIN_DIR . "views/$name.php";
		ob_start();
		include_once($file);
		echo ob_get_clean();
	}
	
	public function adsmatchermonetization_menu_page(): void
	{
		register_setting('adsmatchermonetization', 'adsmatcher_website_publicid');
		register_setting('adsmatchermonetization', 'adsmatcher_wordpress_key');
		add_settings_section('adsmatchermonetization_settings', '', '', 'adsmatchermonetization');
		add_menu_page('AdsMatcher', 'AdsMatcher', 'manage_options', 'adsmatcher_monetization_menu', [$this, 'adsmatcher_monetization_menu_main'], plugins_url( 'img/adsmatcher_icon.png', __FILE__ ), 90);
	}
	
	public function adsmatcher_monetization_menu_main(): void
	{
		AdsMatcherMonetizationPlugin::render('settings');
	}
	
	public function adsmatcherinit(){
		add_action('the_content',array($this, 'adsmatcher_monetizationplugin'));
	}
	
	public function adsmatcher_monetizationplugin($content){
		$adsmatcher_wordpress_publicid = get_option('adsmatcher_website_publicid');
		wp_enqueue_script("adsmatcher-multiformat", "https://www.adsmatcher.com/api/matcher.js?wi=$adsmatcher_wordpress_publicid");
		
		if(!empty($adsmatcher_wordpress_publicid) && !is_home()){
			$content .= "<style>.matchergridbutton {display: inline-block;width: 170px !important;height: 50px !important;line-height: 50px !important;background-color: RGBA(0, 0, 0, 0);border: 1px solid #fff;border-radius: 3px;color: #fff !important;font: normal 500 18px/50px Sans, sans-serif;transform: scale3d(0.0001, 0.0001, 0.0001);text-align: center;position: absolute;left: 0 !important;right: 0 !important;top: 0 !important;bottom: 0 !important;margin: auto !important;text-decoration: none !important;transition: all 1s;}.matchergridlayout {height: 100%;width: 100% !important;position: absolute !important;top: 0;left: 0;background-color: rgba(0, 0, 0, 0.5);z-index: 99999;}#matchergridcomposite .mgline {position: relative;}@font-face {font-family: 'Open Sans';font-style: normal;font-weight: 400;src: local('Open Sans'), local('OpenSans'), url(https://fonts.gstatic.com/s/opensans/v10/K88pR3goAWT7BTt32Z01m1tXRa8TVwTICgirnJhmVJw.woff2) format('woff2');unicode-range: U+0460-052F, U+20B4, U+2DE0-2DFF, U+A640-A69F;}@font-face {font-family: 'Open Sans';font-style: normal;font-weight: 400;src: local('Open Sans'), local('OpenSans'), url(https://fonts.gstatic.com/s/opensans/v10/RjgO7rYTmqiVp7vzi-Q5UVtXRa8TVwTICgirnJhmVJw.woff2) format('woff2');unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;}@font-face {font-family: 'Open Sans';font-style: normal;font-weight: 400;src: local('Open Sans'), local('OpenSans'), url(https://fonts.gstatic.com/s/opensans/v10/u-WUoqrET9fUeobQW7jkRVtXRa8TVwTICgirnJhmVJw.woff2) format('woff2');unicode-range: U+0100-024F, U+1E00-1EFF, U+20A0-20AB, U+20AD-20CF, U+2C60-2C7F, U+A720-A7FF;}@font-face {font-family: 'Open Sans';font-style: normal;font-weight: 400;src: local('Open Sans'), local('OpenSans'), url(https://fonts.gstatic.com/s/opensans/v10/cJZKeOuBrn4kERxqtaUH3VtXRa8TVwTICgirnJhmVJw.woff2) format('woff2');unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;}@font-face {font-family: 'Open Sans';font-style: normal;font-weight: 700;src: local('Open Sans Bold'), local('OpenSans-Bold'), url(https://fonts.gstatic.com/s/opensans/v10/k3k702ZOKiLJc3WVjuplzCUUniRZcd_wq8DYmIfsw2A.woff2) format('woff2');unicode-range: U+0460-052F, U+20B4, U+2DE0-2DFF, U+A640-A69F;}@font-face {font-family: 'Open Sans';font-style: normal;font-weight: 700;src: local('Open Sans Bold'), local('OpenSans-Bold'), url(https://fonts.gstatic.com/s/opensans/v10/k3k702ZOKiLJc3WVjuplzOXREeHhJi4GEUJI9ob_ak4.woff2) format('woff2');unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;}@font-face {font-family: 'Open Sans';font-style: normal;font-weight: 700;src: local('Open Sans Bold'), local('OpenSans-Bold'), url(https://fonts.gstatic.com/s/opensans/v10/k3k702ZOKiLJc3WVjuplzBUOjZSKWg4xBWp_C_qQx0o.woff2) format('woff2');unicode-range: U+0100-024F, U+1E00-1EFF, U+20A0-20AB, U+20AD-20CF, U+2C60-2C7F, U+A720-A7FF;}@font-face {font-family: 'Open Sans';font-style: normal;font-weight: 700;src: local('Open Sans Bold'), local('OpenSans-Bold'), url(https://fonts.gstatic.com/s/opensans/v10/k3k702ZOKiLJc3WVjuplzOgdm0LZdjqr5-oayXSOefg.woff2) format('woff2');unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;}#matchergridcomposite .mgresponsive {display: inherit;}#matchergridcomposite .matcherbox {padding: 0 !important;position: relative !important;vertical-align: top !important;margin: 0 auto;border-style: solid;border-width: 0;line-height: 100% !important;transition: none !important;box-sizing: border-box;}#matchergridcomposite div.mcimg {padding: 0;text-align: center;}#matchergridcomposite img.mcimg {border-style: solid;border-color: #fff;border-width: 0;width: 100% !important;height: auto !important;max-width: 328px;max-height: 328px;box-sizing: border-box;display: block;}#matchergridcomposite .mctitle {margin-top: 10px;text-align: center;}#matchergridcomposite .mctitle a {font-weight: 700;font-size: 15px;line-height: 15px;font-style: normal;text-decoration: none;color: #333;font-family: 'Open Sans', sans-serif;}#matchergridcomposite .mcdesc {display: none;text-align: center;}#matchergridcomposite .mcdesc a {font-weight: 400;font-size: 12px;line-height: 12px;font-style: normal;text-decoration: none;color: #666;font-family: 'Open Sans', sans-serif;}#matchergridcomposite .mcdomain {display: block;text-align: center;}#matchergridcomposite .mcdomain a {font-weight: 400;font-size: 10px;line-height: 10px;font-style: normal;text-decoration: none;color: #bbb;font-family: 'Open Sans', sans-serif;padding: 4px;display: block;overflow: hidden;}#matchergridcomposite .mcdomain a img.mcimgsrc {vertical-align: bottom;margin-bottom: -3px;height: 20px;width: 20px;display: inline-block;}#matchergridcomposite .mgline {background: none repeat scroll 0 0;cursor: pointer;display: inline-block;padding: 0 !important;border-style: solid;border-color: #fff;border-width: 0;width: 23%;max-width: 23%;box-sizing: border-box;margin: 10px 0.5%;display: -ms-flexbox;display: -webkit-flex;display: flex;-webkit-flex-direction: column;-ms-flex-direction: column;flex-direction: column;word-wrap: break-word;}#matchergridcomposite .mgline .image-container {position: relative;}#matchergridcomposite .mgline .image-container .mcimgad {position: absolute;right: 0;bottom: 0;width: 20px;height: 20px;}#matchergridcomposite .mgline {vertical-align: top;}#matchergridcomposite .matcherbox, #matchergridcomposite .mgline {min-width: 90px;}#matchergridcomposite .mgline[max-width~='120px'] .mcdesc {display: none !important;}@supports not (flex-wrap: wrap) {#matchergridcomposite .matcherbox {display: block !important;}#matchergridcomposite .mgline {display: inline-block !important;}}.text-elements a {text-decoration: none;}#matchergridcomposite div.mcprice {text-align: center;}#matchergridcomposite div.mcprice span {font-weight: 700;font-size: 12px;line-height: 12px;font-style: normal;text-decoration: none;color: #fff;font-family: 'Open Sans', sans-serif;}#matchergridcomposite div.mgarrowbox, #matchergridcomposite div.mgbuybox {display: false;}#matchergridcomposite div.mcprice, #matchergridcomposite div.mgarrowbox, #matchergridcomposite div.mgbuybox {display: none;}#matchergridcomposite span.mcpriceold {text-decoration: line-through !important;}@media (max-width: 480px) {#matchergridcomposite .mgline {width: 48% !important;margin: 1% !important;max-width: 48% !important;}}#matchergridcomposite .mgpopular {background-color: rgba(255, 0, 0, 0.2) !important;border-color: rgba(255, 90, 0, 0.3) !important;}#matchergridcomposite img.mcimg {margin: 0;opacity: 1 !important;}#matchergridcomposite .mgline {position: relative;}#matchergridcomposite .mgline .fake {visibility: hidden;position: relative;padding-top: 4px;}#matchergridcomposite .mgline:hover .mctitle a {color: #595959;text-decoration: underline !important;}#matchergridcomposite .mgline:hover .mcpriceold, #matchergridcomposite .mgline:hover .mcpriceold + .mcprice {visibility: hidden;}#matchergridcomposite .mgline:hover .mcdiscount {display: block;position: absolute;left: 0;right: 0;top: 5px;}#matchergridcomposite .mgarrowbox {position: relative;background: #595959;width: 55%;height: 22px;margin: 0;border-color: transparent;border-left-color: #595959;display: inline-block;font-family: 'Open Sans', sans-serif;}#matchergridcomposite .mgarrowbox:after {left: 100%;top: 50%;content: ' ';height: 0;width: 0;position: absolute;pointer-events: none;margin-top: -11px;border: solid 11px;border-color: inherit;}#matchergridcomposite .mgbuybox {width: 40%;display: inline-block;text-align: right;font-weight: 700;font-family: 'Open Sans', sans-serif;font-size: 12px;color: #666;text-decoration: underline;}#matchergridcomposite .mctitle {margin-top: 2px;line-height: 1 !important;}#matchergridcomposite .mctitle a {line-height: 110% !important;}#matchergridcomposite .mcdesc {margin-top: 0;margin-bottom: 2px;}#matchergridcomposite .mcdesc a {line-height: 1.5 !important;}#matchergridcomposite div.mcprice {margin-top: 5px;line-height: 12 px !important;}#matchergridcomposite div.mgarrowbox, #matchergridcomposite div.mgbuybox {display: none;}#matchergridcomposite .mgtobottom {position: absolute;bottom: 0;width: 100%;text-align: left;}#matchergridcomposite .mgline .image-with-text, #matchergridcomposite .mgline .mgtobottom {width: 100% !important;margin: 0 auto;}#matchergridcomposite .mgline .image-with-text, #matchergridcomposite .mgline .mgtobottom {max-width: 328px;}#matchergridcomposite .matcherhead {font-family: 'Open Sans', sans-serif !important;color: #333;font-size: 14px !important;text-transform: uppercase !important;}#matchergridcomposite .mcpriceold {float: left;padding-left: 5px;}#matchergridcomposite .mcdiscount {display: none;}#matchergridcomposite .mcdomain {display: block;overflow: hidden;padding: 4px;}#matchergridcomposite .mcdomain a {padding: 0;display: block;padding-top: 5px;padding-bottom: 2px;overflow: hidden;}#matchergridcomposite div.mcprice, #matchergridcomposite div.mcriceold {font-weight: 700;font-size: 12px;line-height: 12px;font-style: normal;text-decoration: none;color: #fff;font-family: 'Open Sans', sans-serif;}#matchergridcomposite div.mcpriceold {text-decoration: line-through !important;}#matchergridcomposite .mgline[max-width~='120px'] .mgarrowbox, #matchergridcomposite .mgline[max-width~='120px'] .mgbuybox {display: none !important;}.image-with-text {min-height: 1px;}#matchergridcomposite .matcherbox img {box-shadow: none !important;border-radius: 0 !important;}#matchergridcomposite .matcherbox a {border-bottom: none !important;}#matchergridcomposite div.mcimg a.close-informer {width: 14px;height: 14px;background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyFpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDIxIDc5LjE1NDkxMSwgMjAxMy8xMC8yOS0xMTo0NzoxNiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo5NzI0ODBDMzY3ODcxMUU1OEM4RUU2RUJCOUREODIyQiIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo5NzI0ODBDNDY3ODcxMUU1OEM4RUU2RUJCOUREODIyQiI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjk3MjQ4MEMxNjc4NzExRTU4QzhFRTZFQkI5REQ4MjJCIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjk3MjQ4MEMyNjc4NzExRTU4QzhFRTZFQkI5REQ4MjJCIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+uNcpEQAAAHxJREFUeNqckgEKwCAIRe3fYjfKc2zX6hydaLRbbDnGkLDIPggl/5lKIcbIRJRqbDSnUmOHE6LPm+CEfhj6lnN+o5WVh1VOm6xColCXc/cgLWYev9gaejnQojCab5RDzyDt6RantqoBaz5zq54ZywJ3CXjIwQGd8skfAQYALdQqftYulocAAAAASUVORK5CYIJ0ZW50Ij4NCiA8ZGl2IGNsYXNzPSJjb250ZW50LWNvbnRhaW5lciI+PGZpZWxkc2V0Pg0KICA8aDI+NTAyIC0gV2ViIHNlcnZlciByZWNlaXZlZCBhbiBpbnZhbGlkIHJlc3BvbnNlIHdoaWxlIGFjdGluZyBhcyBhIGdhdGV3YXkgb3IgcHJveHkgc2VydmVyLjwvaDI+DQogIDxoMz5UaGVyZSBpcyBhIHByb2JsZW0gd2l0aCB0aGUgcGFnZSB5b3UgYXJlIGxvb2tpbmcgZm9yLCBhbmQgaXQgY2Fubm90IGJlIGRpc3BsYXllZC4gV2hlbiB0aGUgV2ViIHNlcnZlciAod2hpbGUgYWN0aW5nIGFzIGEgZ2F0ZXdheSBvciBwcm94eSkgY29udGFjdGVkIHRoZSB1cHN0cmVhbSBjb250ZW50IHNlcnZlciwgaXQgcmVjZWl2ZWQgYW4gaW52YWxpZCByZXNwb25zZSBmcm9tIHRoZSBjb250ZW50IHNlcnZlci48L2gzPg0KIDwvZmllbGRzZXQ+PC9kaXY+DQo8L2Rpdj4NCjwvYm9keT4NCjwvaHRtbD4NCg==);display: block;opacity: 0;position: absolute;right: 3px;top: 3px;z-index: 1;cursor: pointer;}#matchergridcomposite div.mgline:hover a.close-informer {opacity: 0.7;-moz-transition: all 0.3s ease-out;-o-transition: all 0.3s ease-out;-webkit-transition: all 0.3s ease-out;-ms-transition: all 0.3s ease-out;transition: all 0.3s ease-out;}#matchergridcomposite div.mgline a.close-informer:hover {opacity: 1;-moz-transition: all 0.3s ease-out;-o-transition: all 0.3s ease-out;-webkit-transition: all 0.3s ease-out;-ms-transition: all 0.3s ease-out;transition: all 0.3s ease-out;}#matchergridcomposite div.mcimg {position: relative;display: inline-block;}div.image-with-price {position: relative;}#matchergridcomposite .mgline .image-container {width: auto;margin: 0 auto;position: relative;}.matchernativetile {box-sizing: border-box;-moz-border-radius: 2px;-webkit-border-radius: 2px;border-radius: 2px;display: block;position: relative;background-color: #fff;border: 1px solid #e3e3e3;border-bottom-color: #e3e3e3;border-bottom-color: #cacaca;font-size: 0.87em;margin: 8px 5px;margin-right: 5px;margin-bottom: 8px;margin-left: 5px;line-height: 1.37;padding: 0;opacity: 1;width:100%;max-width:100%;}.matchernativetile--vid .matchernativetile__media {margin: auto;display: block;width: 100%;max-width: 100%;overflow: hidden;position: relative;}.matchernativetile--vid .matchernativetile__media__img {text-indent: -9999px;background-color: #f7f7f7;position: absolute;margin: auto;bottom: 0;right: 0;left: 0;top: 0;}.matchernativetile__media__img {display: block;margin: 0 auto;color: transparent;}a img {border: none;}.matchernativetile--vid .matchernativetile__body {padding-top: 0.8em;padding-bottom: 0.8em;}.matchernativetile__body {-moz-transform-style: inherit;-webkit-transform-style: inherit;transform-style: inherit;-moz-box-sizing: border-box;-webkit-box-sizing: border-box;box-sizing: border-box;padding: 1em;padding-top: 1em;padding-bottom: 1em;word-wrap: break-word;word-break: initial;overflow: hidden;text-decoration: none;font-style: normal;color: #595959;font-family: 'Open Sans', sans-serif;}.matchernativetile--vid .matchernativetile__title--2 {display: block;display: -webkit-box;white-space: normal;height: 2.5em;}.matchernativetile--vid .matchernativetile__title--2 {margin-bottom: 0.8em;}.matchernativetile__title--2 {font-size: 1.2em;}.matchernativetile__title {padding: 0;line-height: 1.25;height: 2.5em;margin-bottom: 0.7em;margin-top: 0;text-overflow: -o-ellipsis-lastline;display: block;display: -webkit-box;-webkit-line-clamp: 2;-webkit-box-orient: vertical;}.matchernativetile__title {font-weight: 600;color: #333;overflow: hidden;}.matchernativetile__body {word-wrap: break-word;word-break: initial;}.matchernativetile__title a {color: inherit;text-decoration: none;font-weight: 700;font-size: 15px;font-style: normal;color: #333;font-family: 'Open Sans', sans-serif;}.matchernativetile--vid .matchernativetile__count {float: right;}.matchernativetile__count {color: #aaa;}.matchernativetile__favicon {max-width: 29px;max-height: 16px;margin-top: -3px;vertical-align: middle;margin-right: 0.5em;}.matcherhead {font-weight: 700;font-size: 14px;text-transform: uppercase;text-align: left;font-family: 'Open Sans', sans-serif;color: #4555a7;display: block;margin: 5px 0 0px 5px;float: left;}.matcherheader {display: table !important;width: 120% !important;margin-bottom: 0px;}div.matcher_morewidget {text-align: right;opacity: 0.5;margin-right: 10px;display: inline-block;float: right;}div.matcher_morewidget:hover {opacity: 1;}div.matcher_morewidget a {color: #000000;font: normal 10px Myriad Pro;text-decoration: none;}div.matcher_morewidget img {margin: 0px 60px 0px 0px;border: 0px;float: none;padding: 0px;}</style><div id='matchergridcomposite'><div class='matcherbox'><div id='".$adsmatcher_wordpress_publicid."'></div></div></div>";
		}
		return $content;
	}

}